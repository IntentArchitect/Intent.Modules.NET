@page "/customer-search"

@using BlazorServerTests.Application.Customers

<MudPaper Class="pa-4 mb-4 ux-gradient-primary" Elevation="0">
    <MudText Typo="Typo.h4" Class="text-white font-weight-bold mb-2">
        <MudIcon Icon="@Icons.Material.Filled.Person" Class="mr-2" />
        Customers Management
    </MudText>
    <MudText Typo="Typo.body1" Class="text-white opacity-90">
        View and manage your customer list.
    </MudText>
</MudPaper>

<MudCard Class="ux-fade-in-up" Style="animation-delay: 0.1s">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5">Customers</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="SearchText"
                              Placeholder="Search by name"
                              Label="Search"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              Margin="Margin.Normal"
                              Immediate="true"
                              OnKeyDown="@(async e => { if(e.Key=="Enter" && _table!=null) await _table.ReloadServerData(); })"
                              Class="mb-4" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudSelect T="bool?" @bind-Value="IsActive" Label="Active status" Placeholder="All" Margin="Margin.Normal" Class="mb-4" Dense>
                    <MudSelectItem T="bool?" Value="null">All</MudSelectItem>
                    <MudSelectItem T="bool?" Value="true">Active</MudSelectItem>
                    <MudSelectItem T="bool?" Value="false">Inactive</MudSelectItem>
                </MudSelect>
            </MudItem>
            <MudItem xs="12">
                <MudButton Variant="Variant.Filled"
                           StartIcon="@Icons.Material.Filled.Search"
                           Color="Color.Primary"
                           OnClick="@(async () => { if (_table != null) await _table.ReloadServerData(); })"
                           Class="mb-4 ml-md-4">
                    <MudText>Search</MudText>
                </MudButton>
                <MudButton Variant="Variant.Filled"
                           StartIcon="@Icons.Material.Filled.Add"
                           Color="Color.Secondary"
                           OnClick="@AddCustomer"
                           Class="mb-4 ml-md-4">
                    <MudText>Add Customer</MudText>
                </MudButton>
            </MudItem>
            <MudItem xs="12">
                <MudTable T="CustomerDto"
                          @ref="_table"
                          ServerData="LoadServerData"
                          Dense="true"
                          Hover="true"
                          Striped
                          Elevation="2">
                    <HeaderContent>
                        <MudTh>
                            <MudTableSortLabel T="CustomerDto" SortLabel="@nameof(CustomerDto.Name)">
                                Name
                            </MudTableSortLabel>
                        </MudTh>
                        <MudTh>
                            <MudTableSortLabel T="CustomerDto" SortLabel="@nameof(CustomerDto.Surname)">
                                Surname
                            </MudTableSortLabel>
                        </MudTh>
                        <MudTh>
                            <MudTableSortLabel T="CustomerDto" SortLabel="@nameof(CustomerDto.Email)">
                                Email
                            </MudTableSortLabel>
                        </MudTh>
                        <MudTh>Status</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Name">@context.Name</MudTd>
                        <MudTd DataLabel="Surname">@context.Surname</MudTd>
                        <MudTd DataLabel="Email">@context.Email</MudTd>
                        <MudTd DataLabel="Status">
                            @if (context.IsActive)
                            {
                                <MudChip T="string" Color="Color.Success" Variant="Variant.Filled" Size="Size.Small">Active</MudChip>
                            }
                            else
                            {
                                <MudChip T="string" Color="Color.Error" Variant="Variant.Filled" Size="Size.Small">Inactive</MudChip>
                            }
                        </MudTd>
                    </RowTemplate>
                    <PagerContent>
                        <MudTablePager PageSizeOptions="new int[] {10, 25, 50, 100}" />
                    </PagerContent>
                </MudTable>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>
