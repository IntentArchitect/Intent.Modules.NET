<?xml version="1.0" encoding="utf-8"?>
<stereotypeDefinition id="9c43b6a8-7d38-4799-b441-399923e5790b" version="3.1.0">
  <comment>Rename to Http Parameter Settings</comment>
  <name>Parameter Setting</name>
  <targetMode>of-type</targetMode>
  <targetTypes>
    <type id="b6d4f537-eebe-4c56-8cb0-7687cf5bbe16">Azure Function Parameter</type>
  </targetTypes>
  <targetReferenceTypes />
  <applyMode>always</applyMode>
  <icon type="FontAwesome" source="cogs" />
  <displayIcon>false</displayIcon>
  <displayIconFunction>return false;</displayIconFunction>
  <displayFunction>if (properties["Source"].value == "Default") {
    let funcSettings = element.getParent().getStereotype("Azure Function");
    if (funcSettings == null) {
        return null;
    }

    let verb = funcSettings.getProperty("Method").getValue()?.toString()
    let route = funcSettings.getProperty("Route").getValue()?.toString() ?? "";
    if (route.indexOf(`{${element.getName()}}`) !== -1) {
        return "[From Route]";
    }
    if ((verb == "POST" || verb == "PUT") &amp;&amp; 
        element.typeReference.getType().specialization !== "Type-Definition") {
        return "[From Body]";
    }

    if ((verb == "GET" || verb == "DELETE") &amp;&amp;
        element.typeReference.getType().specialization == "Type-Definition") {
        return "[From Query]";
    }
    
    return "[From Query]";
}
return `[${properties["Source"].value}]`;</displayFunction>
  <displayAsAnnotation>true</displayAsAnnotation>
  <displayAsText>false</displayAsText>
  <autoAdd>false</autoAdd>
  <allowMultipleApplies>false</allowMultipleApplies>
  <parentFolderId>022dbddc-276c-406b-81e6-5034ad64db72</parentFolderId>
  <order>0</order>
  <packageId>022dbddc-276c-406b-81e6-5034ad64db72</packageId>
  <packageName>Intent.AzureFunctions</packageName>
  <properties>
    <property id="dcb4773e-551c-441f-a73f-617f1f0ead9e">
      <name>Source</name>
      <type>string</type>
      <controlType>select</controlType>
      <optionsSource>options</optionsSource>
      <placeholder>(required)</placeholder>
      <defaultValue>Default</defaultValue>
      <valueOptions>
        <option>Default</option>
        <option>From Body</option>
        <option>From Form</option>
        <option>From Header</option>
        <option>From Query</option>
        <option>From Route</option>
      </valueOptions>
      <lookupTypes />
      <isRequiredFunction>return true;</isRequiredFunction>
    </property>
    <property id="d069f699-ea31-47dd-b044-d68d112a664e">
      <name>Header Name</name>
      <type>string</type>
      <controlType>text</controlType>
      <optionsSource>n/a</optionsSource>
      <placeholder />
      <valueOptions />
      <lookupTypes />
      <isActiveFunction>return properties["Source"].value === "From Header";</isActiveFunction>
    </property>
  </properties>
</stereotypeDefinition>