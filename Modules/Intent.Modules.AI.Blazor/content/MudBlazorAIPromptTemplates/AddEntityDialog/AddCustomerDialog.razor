@using UI.AI.Samples.Api.Components.Pages.Dialogs.Customers
@using UI.AI.Samples.Application.Customers
@using UI.AI.Samples.Domain
<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Class="mr-2" />
            Add Customer
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudAlert Severity="Severity.Info" Variant="Variant.Text" Dense Class="mb-2">
            Enter the details for the new customer.
        </MudAlert>
        <MudForm @ref="_form" Model="@Model">
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="Model.Name" Label="Name" Placeholder="Enter name" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Badge" Immediate Required RequiredError="Name is required" />
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="Model.Surname" Label="Surname" Placeholder="Enter surname" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Person" Immediate Required RequiredError="Surname is required" />
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="Model.Email" Label="Email" InputType="InputType.Email" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Email" Required="true" RequiredError="Email is required" Validation="@EmailRule" Immediate DebounceInterval="250" />
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudSwitch T="bool" @bind-Value="Model.IsActive" Color="Color.Primary" Label="Active customer?" Class="mt-4" />
                </MudItem>
                <MudItem xs="12">
                    <MudDivider Class="my-4" />
                    <MudText Typo="Typo.h6">Preferences</MudText>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudSwitch T="bool" @bind-Value="Model.Preference.Specials" Color="Color.Primary" Label="Receive specials" />
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudSwitch T="bool" @bind-Value="Model.Preference.NewsLetter" Color="Color.Primary" Label="Subscribe to newsletter" />
                </MudItem>
                <MudItem xs="12">
                    <MudDivider Class="my-4" />
                    <MudText Typo="Typo.h6">Addresses</MudText>
                </MudItem>
                <MudItem xs="12">
                    <MudTable T="CreateCustomerCommandAddressesModel1" Items="@Model.Addresses" Elevation="1" Dense Hover Striped>
                        <HeaderContent>
                            <MudTh>Type</MudTh>
                            <MudTh>Line 1</MudTh>
                            <MudTh>Line 2</MudTh>
                            <MudTh>City</MudTh>
                            <MudTh>Postal</MudTh>
                            <MudTh></MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Type">@context.AddressType.ToString()</MudTd>
                            <MudTd DataLabel="Line 1">@context.Line1</MudTd>
                            <MudTd DataLabel="Line 2">@context.Line2</MudTd>
                            <MudTd DataLabel="City">@context.City</MudTd>
                            <MudTd DataLabel="Postal">@context.Postal</MudTd>
                            <MudTd>
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(() => RemoveAddress(context))" Size="Size.Small" Edge="Edge.End" Disabled="@_saving" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudItem>
            </MudGrid>
        </MudForm>
        <MudGrid>
            <MudItem xs="12">
                <MudExpansionPanels>
                    <MudExpansionPanel Text="Add Address" Disabled="@_saving">
                        <MudForm @ref="_addressForm" Model="@_newAddress">
                            <MudGrid>
                                <MudItem xs="12" md="6">
                                    <MudSelect T="AddressType" @bind-Value="_newAddress.AddressType" Label="Address Type" Required RequiredError="Type required">
                                        <MudSelectItem T="AddressType" Value="AddressType.Deliver">Delivery</MudSelectItem>
                                        <MudSelectItem T="AddressType" Value="AddressType.Billing">Billing</MudSelectItem>
                                    </MudSelect>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="_newAddress.Line1" Label="Address line 1" Required RequiredError="Required" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="_newAddress.Line2" Label="Address line 2" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="_newAddress.City" Label="City" Required RequiredError="Required" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="_newAddress.Postal" Label="Postal code" Required RequiredError="Required" />
                                </MudItem>
                                <MudItem xs="12">
                                    <MudButton OnClick="AddAddress" Variant="Variant.Filled" Color="Color.Primary" Disabled="@_saving">
                                        <MudIcon Icon="@Icons.Material.Filled.Add" class="mr-1" /> Add address
                                    </MudButton>
                                </MudItem>
                            </MudGrid>
                        </MudForm>
                    </MudExpansionPanel>
                </MudExpansionPanels>
            </MudItem>
        </MudGrid>
        <MudDivider Class="my-5" />
        <MudExpansionPanels>
            <MudExpansionPanel Text="Loyalty (Optional)" Disabled="@_saving" Expanded="@_showLoyalty" >
                <MudSwitch T="bool" @bind-Value="_showLoyalty" Color="Color.Primary" Class="mb-3" Label="Capture loyalty information?" />
                @if (_showLoyalty)
                {
                    <MudForm @ref="_loyaltyForm" Model="@_loyaltyModel">
                        <MudGrid>
                            <MudItem xs="12" md="6">
                                <MudTextField @bind-Value="_loyaltyModel.LoyaltyNo" Label="Loyalty Number" Placeholder="Enter loyalty number" />
                            </MudItem>
                            <MudItem xs="12" md="6">
                                <MudNumericField T="int" @bind-Value="_loyaltyModel.Points" Label="Points" Placeholder="0" Min="0" />
                            </MudItem>
                        </MudGrid>
                    </MudForm>
                }
            </MudExpansionPanel>
        </MudExpansionPanels>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="SaveAsync" Disabled="@_saving" Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save">
            @if (_saving)
            {
                <MudProgressCircular Size="Size.Small" Indeterminate Class="mr-2" />
                <span>Savingâ€¦</span>
            }
            else
            {
                <span>Save</span>
            }
        </MudButton>
        <MudButton OnClick="Cancel" Disabled="@_saving" Color="Color.Secondary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Close">
            Cancel
        </MudButton>
    </DialogActions>
</MudDialog>
